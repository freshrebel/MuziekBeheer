DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'DataLayerFramework.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201710131517058_InitialCreate'
BEGIN
    CREATE TABLE [dbo].[Albums] (
        [AlbumId] [int] NOT NULL IDENTITY,
        [AlbumName] [nvarchar](max),
        [AlbumReleaseDate] [datetime],
        CONSTRAINT [PK_dbo.Albums] PRIMARY KEY ([AlbumId])
    )
    CREATE TABLE [dbo].[SongAlbums] (
        [AlbumId] [int] NOT NULL,
        [SongId] [int] NOT NULL,
        [AlbumSequenceNumber] [int] NOT NULL,
        CONSTRAINT [PK_dbo.SongAlbums] PRIMARY KEY ([AlbumId], [SongId])
    )
    CREATE INDEX [IX_AlbumId] ON [dbo].[SongAlbums]([AlbumId])
    CREATE INDEX [IX_SongId] ON [dbo].[SongAlbums]([SongId])
    CREATE TABLE [dbo].[Songs] (
        [SongId] [int] NOT NULL IDENTITY,
        [SongName] [nvarchar](max),
        [Lenght] [time](7),
        [Bpm] [int],
        [Rating] [int],
        [SongReleaseDate] [datetime],
        CONSTRAINT [PK_dbo.Songs] PRIMARY KEY ([SongId])
    )
    CREATE TABLE [dbo].[SongPlaylists] (
        [SongId] [int] NOT NULL,
        [PlaylistId] [int] NOT NULL,
        [PlaylistSequence] [int] NOT NULL,
        [DateAdded] [datetime],
        CONSTRAINT [PK_dbo.SongPlaylists] PRIMARY KEY ([SongId], [PlaylistId])
    )
    CREATE INDEX [IX_SongId] ON [dbo].[SongPlaylists]([SongId])
    CREATE INDEX [IX_PlaylistId] ON [dbo].[SongPlaylists]([PlaylistId])
    CREATE TABLE [dbo].[Playlists] (
        [PlaylistId] [int] NOT NULL IDENTITY,
        [PlaylistName] [nvarchar](max),
        CONSTRAINT [PK_dbo.Playlists] PRIMARY KEY ([PlaylistId])
    )
    CREATE TABLE [dbo].[SongArtists] (
        [SongId] [int] NOT NULL,
        [ArtistId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.SongArtists] PRIMARY KEY ([SongId], [ArtistId])
    )
    CREATE INDEX [IX_SongId] ON [dbo].[SongArtists]([SongId])
    CREATE INDEX [IX_ArtistId] ON [dbo].[SongArtists]([ArtistId])
    CREATE TABLE [dbo].[Artists] (
        [ArtistId] [int] NOT NULL IDENTITY,
        [ArtistName] [nvarchar](max),
        [BornAt] [nvarchar](max),
        [BornOn] [datetime],
        [Nationality] [nvarchar](max),
        CONSTRAINT [PK_dbo.Artists] PRIMARY KEY ([ArtistId])
    )
    CREATE TABLE [dbo].[SongGenres] (
        [SongId] [int] NOT NULL,
        [GenreId] [int] NOT NULL,
        CONSTRAINT [PK_dbo.SongGenres] PRIMARY KEY ([SongId], [GenreId])
    )
    CREATE INDEX [IX_SongId] ON [dbo].[SongGenres]([SongId])
    CREATE INDEX [IX_GenreId] ON [dbo].[SongGenres]([GenreId])
    CREATE TABLE [dbo].[Genres] (
        [GenreId] [int] NOT NULL IDENTITY,
        [GenreName] [nvarchar](max),
        CONSTRAINT [PK_dbo.Genres] PRIMARY KEY ([GenreId])
    )
    ALTER TABLE [dbo].[SongAlbums] ADD CONSTRAINT [FK_dbo.SongAlbums_dbo.Albums_AlbumId] FOREIGN KEY ([AlbumId]) REFERENCES [dbo].[Albums] ([AlbumId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongAlbums] ADD CONSTRAINT [FK_dbo.SongAlbums_dbo.Songs_SongId] FOREIGN KEY ([SongId]) REFERENCES [dbo].[Songs] ([SongId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongPlaylists] ADD CONSTRAINT [FK_dbo.SongPlaylists_dbo.Playlists_PlaylistId] FOREIGN KEY ([PlaylistId]) REFERENCES [dbo].[Playlists] ([PlaylistId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongPlaylists] ADD CONSTRAINT [FK_dbo.SongPlaylists_dbo.Songs_SongId] FOREIGN KEY ([SongId]) REFERENCES [dbo].[Songs] ([SongId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongArtists] ADD CONSTRAINT [FK_dbo.SongArtists_dbo.Artists_ArtistId] FOREIGN KEY ([ArtistId]) REFERENCES [dbo].[Artists] ([ArtistId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongArtists] ADD CONSTRAINT [FK_dbo.SongArtists_dbo.Songs_SongId] FOREIGN KEY ([SongId]) REFERENCES [dbo].[Songs] ([SongId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongGenres] ADD CONSTRAINT [FK_dbo.SongGenres_dbo.Genres_GenreId] FOREIGN KEY ([GenreId]) REFERENCES [dbo].[Genres] ([GenreId]) ON DELETE CASCADE
    ALTER TABLE [dbo].[SongGenres] ADD CONSTRAINT [FK_dbo.SongGenres_dbo.Songs_SongId] FOREIGN KEY ([SongId]) REFERENCES [dbo].[Songs] ([SongId]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201710131517058_InitialCreate', N'DataLayerFramework.Migrations.Configuration',  0x1F8B0800000000000400DD5D4B6FE4B811BE07C87F10744A02AFDB9E392431BA77E1B1670263C70FB83D8BDC0C5AA2DBC2EAD12BB11D1B417E590EF949F90BA1DE7C8BA49E13CCA52D9255A5AAAF8A6489ACF9EFBFFFB3FEE92D0A9D57986641126FDCD3E313D781B197F841BCDBB807F4FCC35FDC9F7EFCFDEFD69FFDE8CDF9A5EEF731EF8747C6D9C67D41687FB65A65DE0B8C40761C055E9A64C9333AF6926805FC64F5E1E4E4AFABD3D315C4245C4CCB71D6F7871805112CFEC07F5E24B107F7E800C2EBC48761563DC72DDB82AA73032298ED810737EE2540E02B7887E997143FFC4792FEEA3AE76100B0245B183EBB0E88E3040184E53CFB96C12D4A9378B7DDE307207C78DF43DCEF198419ACE43F6BBBEBBECAC987FC5556EDC09A9477C8501219123CFD58E966C50EB7D2B0DBE80E6BEF33D6327ACFDFBAD0E0C63D0F9F0E91EBB09CCE2EC234EF556AB7B441A3DEE362D09123683A6A10818193FF3B722E0E213AA47013C3034A4178E4DC1D9EC2C0FB19BE3F24BFC278131FC29094114B89DBA807F8D15D9AEC618ADEEFE13329F995EF3A2B7AF08A1DDD8C6507962F7815A38F1F5CE7068B019E42D8808150C6162529FC1B8C610A10F4EF004230C5B6BCF261A14E4E0411C3FC67CD1243107B93EB5C83B7AF30DEA1978D8B7FBACE97E00DFAF5934A8C6F71809D0F0F42E9016A71BA87210419C4D66918E6BF1F82881F7F035E835DF1920CA52DF691825AE63A9860D1257B09F6A54F1D37CD8F1580BEA449749F84E4C8B2E9F101A43B88B02489B87D9B1C528F916CBD6A81AA846F43CC14C2CDC085C258D837177A44C4ABB15533EF43A310640B7F3BE01905DE1CA227981A129402B642413FACD6589461B5C6B2891749657AACFD8B96A77A2CF49BBAADB7CFD8B8CBDC9E628B7E3DE00E17EE737E9344FB7CEC0BAAD908E33B33E2D33E62F4A0EE7F8F15928B6E30247FFB4166A08ED9A7C37B449ECC7A96AE247721780F830CC985A97B3C96BE458B44350ADD9AEE2172EECEA93A454A01CB76A178449378AE26DA6D44C38E9442B96445B350B0B6452817D1DC3B1CD606B0098BF5D865864761D75AE4F1A2A93A4690FC87A053AF28FA51CB43D4B9EF43DF3E66B53812A09DF27222A6B4A817F7E0D02FE966E39C43443451A815C73C2BFFB4F5CDA5F8651F67D37794E1962F35CF7196304A34AA275A6BFF6101DAE166F61BD162A6B4DA891623E746AAC10C520A3CD7FCD1721F68EF58194E003A62F5D3ACB15AC0F1AD5CB016741934506BAEEC843B5BC1CACF0AFC76C05F06E8ED91AC8BC201138905C749F6969F92343E4793B0B98D3B175CCCA89B429B202C5436E90CA5DA6719870AD62715D1C47A4E2A764936535231706EE73498910A79E79A901AE6C3CC4795D104186B37BDF5B6BA4518DBC64D455C87412722AD8DBC681A12ECF3ADE06E05F545C0DC1ABB9AB81B6E062A18CEB0335024918C5C82C59FD4677410789E65891714F2B09FA3AA4F0DF41B7E8E7DA7E3BB43A953EAAB05D62D865DB0C740C3326CDC3F719A93D36D22404B5748F3D465417A1B5FC21022E89C7BE587EB0B9079C0E7CD8675E3D34F30AE619AC3098417D852D8538218F14E10C45EB007A15A726698E117B455C3856DB9847B18E798571BA427FB860BA3B22E0DAD5704B4BA1157A7C255A8E0F2E234D2460584581201360D306F0D3246113A1696AE42CCF0C5BC783FCE13404B926F91D9B62BF9D29AB9CDE84D02BAAEAC2A8D3F9970034150AD251D4CC8F3894688546BA5BF2013C53E3A4FAD8A3B92A4B5ADF555C425D05AE6AC2B147DC2B028B4CBE283A360B32FC3876AE74FACCBAA1CDA24215195B764A663A158030543B966B4165E92CC9D1102E59AE82BC2440190CCFF2AB705A264B09DADE584BFABC027107CC2B027B0C7E2831EB7D596E142BEEF6E8151A56B268977F2D4180D54A14C03053B994E74AC2E491019814EA6839EFC270A73447651158C44A9462B134BC97E57218E977BC208C7DB626101AECCEAE131088F8029214076F92448247FCB60954BCEAA1C268B999CDE1622E604639B3DA473701CE4E8E14D36444482489568909151D01A4C1CB5101269F74C1DC45484B489509FD7C46AA996311D84E4443409902967A12055A8E9202325211E4E60590095FA883BD14B720A9E75AFEEE47423380D4DCE51BBD3D104253115CA65713F4D15346782C5AF2FCC9376664A99D7EE7E6336C1A9A5378B37969D87E25F5E27936792CB23DE88E0AB504B470A8ED19094A6252C98B38C62702812499AA924DDB7D04C1E75E1CE4219A2130ABC36BA521BBAC90DD2CB6B6E0A4D287212AC0789A959A2833A4025899BB23DB6D62E5B4F7AAD7DF50898E03F9FF23A50EFFBF4767E84E835238502A41B36460362529648204F30888120DB85E8EC43B424D7D979F40041FD25BB59F3366DEB5579B1BA7AB05E496E60AFAFC17E1F60AEEDC8EA89B32DAF635FFCB035BFA71C9534561E852D7685DE7042490A769069C5ACB1A45F823443F9718E27909F39B8F023AE5BBDC297ACCB6A2ED4229EB752BD5AABBBE7BF9B8B04CC85F463E19AABD51DEEB88BF2DD53713C835D1EF1E39CFC1E3C08412ABBE87991848728EEF840DD41A73CE6C1512A1F1BD2A26E847124A9569EF27AC5A889DB1A72D6E076D4B46DB52C4F2CD67A5ABFDDAC99234031766C14D45B71928C6C7BDE210D7BE797938CEDB028140C02004BDBEB9B7D1873E52378CF6F9FEA53AAAFA79274EA67FA548A2BAB2489E281FEF8FA0A2B49A27E66A615690CE31A17055ED57ECF18C44D9AC60ECCF2E1E3829A3CAA4052521D61E8A6D65E3B14D16C5BF5291357104992C4E3C5406B3058F58094399CC601021F2FE996C5184DBDA7375FD3948952CB458D64F0C8AB91E68B3DB504917EC79FCD540399C9DA44A6E63157AC9A9260F7413C37583F541799A82544F5CC8C4A7E4F89A5923FD3A742DD5B2249510D8B81A032E1631C2CCACF1976B1423276DC50D17CF426C948BF84CF66A5612C646B1D43CB98EA5449870F11C4E389EDC365D6D82E0DF726C3C664D2D65556ABBBE02197E62ABBB80E56D26BE01729AEF70CC1E838EF70BCFD2DBC0803FCBE6D876B1007CF3043E5B525F7C3C9E907A666E272EA17AEB2CC0F055941AE88216DAC496B0806B9723BAF56D9144B2BC15C72895F41EABD80F40F1178FB2349AE4F69401FFF46C59D5B153D8B827CC39943D8571CCFED2CC79DF4B88A7DF8B671FF598C3973AEFEFE580D3B726E53EC3F67CE89F3AF9E15F4743997A37A315694DD2BA4509233AB2B6761755B4B0AD439B40BB669AF013C902ED756FADC5D0ABDA0ACA0FB67537A443137C68A3AA3E9D26E1604B8ACD768F144BCCD5F7055AC095D9BAF10A4CBBC1D3988006C0DAEEEC0C2D3E22A700D0CA63E401AB68CD328D14A54B9C92062D9D43A1AD72387AA3234E554CB1485D15E5F54E30C989B96E7B159900D561C679C1532570FA7D7044DD7BCE94DAAAD6BA317C6782A823A3763F9B3601FBFD4122D137A33535F439773356C0C5FB6B6D3503546467164AEACC80030B7AFCE519DA19EB46886E0D0F4A4A51164C753462EB7F17F546163CE9A1AD3E34572A265BCEB92DA6891335C6ECD8C39CB63D05778E6A9863165E18B8E632CDF7D9D8B39E3D05C389A3A1A19E167D680645CA762BEA214445A61862A14D3959C509E9CF9AE6B4CCCBA049A0139932F82F451336BD031AB13315B558836EF31791D88C9AA3EA84EDE7CC7751EE68C34D34366EA38A30F9809C30C73BEA61280BFF2C59A4E5093415E92A13C49B371FDA7045BB84C39492E6CB394891D37479D681371206E1AE97091167390D1D623DBAED185E4DB66191BF9BD6D969D82959A8D3E0B72F217DBA36A941A4472CB9843948C898A812E7122B2085FA26A93BD83E47A2CCB45C641415D4279FCEA14948B117724B5EA50888B312CA9FA0427E1CC2F36419109613D09EDA209D2BA0B4B2D1E616EE1295E75B4D210823A109AA50F2495139658F6C1C26B477EC531CA3AF0451CF4CA17886B1F2CAF6883B91587793D83AA0CFC1971BCA23EC4F9E182F2AF4B9805BB96C41AD38CA147ADA59B3E57F173522FE91989EA2ECC77DA6B88808F17DA394C9F818770B307B3AC3848F80B080FB8CBE7E809FA57F1ED01ED0F08BF328C9E42EA524BBE3550F12F4A4FD032AF6FF7C57FFA30C42B603183FC3CC66DFCE910847E23F717C1477909897CCF517DFCCE6D89F28FE0BBF786D24D126B12AAD4D76C951E60B40F31B1EC36DE82576823DBB70C7E853BE0BDD747FDE544BA0D41AB7D7D19805D0AA2ACA2D18EC77F620CFBD1DB8FFF03DAE68A4541820000 , N'6.1.3-40302')
END

